/*! cyark | http://cyark.org/ | 2015-07-23 */
!function(){var a=window.CyArk=window.CyArk||{};a.controls={},a.data={},a.pages={},a.utils={},a.strings={},a.paths={project:"//cyarkpublicdata.blob.core.windows.net/projects/"},function(){function b(){var a=!1;try{var b=document.createElement("canvas");a=!(!window.WebGLRenderingContext||!b.getContext("experimental-webgl")&&!b.getContext("webgl")),b=void 0}catch(c){a=!1}return a}a.arm="arm"===window.navigator.cpuClass,a.use3d=Modernizr.webgl&&b(),a.use3d||$("body").addClass("use2d"),navigator.msMaxTouchPoints&&$("body").addClass("touch")}(),function(){function a(a,b,c,d){"undefined"!=typeof _gaq&&_gaq.push&&_gaq.push(["_trackEvent",a,b,c,d]),"function"==typeof ga&&ga("send","event",a,b,c,d)}window.ieFlyout&&window.ieFlyout.on("flyoutOpened",function(){a("ie-page-logo","click","flyout")}),$("#footerIELink").on("click",function(){a("ie-page-logo","click","footer-link")}),$("#footerIEButton").on("click",function(){a("ie-page-logo","click","footer-download-button")})}(),String.prototype.endsWith||Object.defineProperty(String.prototype,"endsWith",{value:function(a,b){var c=this.toString();(void 0===b||b>c.length)&&(b=c.length),b-=a.length;var d=c.indexOf(a,b);return-1!==d&&d===b}}),function(){var b=!1;try{b=!!window.localStorage}catch(c){}a.settings={get:function(a){return b?localStorage.getItem(a):null},set:function(a,c){b&&(null==c?localStorage.removeItem(a):localStorage.setItem(a,c.toString()))},remove:function(a){b&&localStorage.removeItem(a)},getBoolOrDefault:function(a,b){var c=this.get(a);return null==c?b:"true"===c},getIntOrDefault:function(a,b){var c=this.get(a);return null==c?b:parseInt(c,10)},getSoundEnabled:function(){return this.getBoolOrDefault("soundEnabled",!0)},setSoundEnabled:function(a){return this.set("soundEnabled",a===!0)}}}(),function(){var b,c={url:document.URL,twitterMessage:"The worldâ€™s heritage sites, at your fingertips in beautiful 3D at cyark.com."},d=function(a,b,c,d){var e=c||550,f=d||300,g=screen.width/2-e/2,h=screen.height/3-f/2;window.open(a,b,"height="+f+",width="+e+",left="+g+",top="+h+",resizable=1")},e=function(){var a="http://twitter.com/share?url="+encodeURIComponent(b.url)+"&text="+encodeURIComponent(b.twitterMessage)+"&count=none/";d(a,"Tweet")},f=function(){var a="http://www.facebook.com/sharer.php?s=100&p[url]="+encodeURIComponent(b.url);d(a,"Share")};a.controls.initSocial=function(d){b=$.extend({},c,d),$("#shareTwitter").on("click",function(){e(),a.analytics.buttonClick("twitter")}),$("#shareFacebook").on("click",function(){f(),a.analytics.buttonClick("facebook")})}}(),function(){function b(a,b,c){var d=new RegExp("([?|&])"+b+"=.*?(&|#|$)","i");if(a.match(d))return a.replace(d,"$1"+b+"="+c+"$2");var e="",f=-1!==a.indexOf("?")?"&":"?";return-1!==a.indexOf("#")&&(e=a.replace(/.*#/,"#"),a=a.replace(/#.*/,"")),a+f+b+"="+c+e}function c(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null===c?null:decodeURIComponent(c[1].replace(/\+/g," "))}var d=function(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)};c&&!d&&a.apply(e,f),clearTimeout(d),d=setTimeout(g,b)}},e=function(a){return a.replace(/[^a-z0-9]/g,function(a){var b=a.charCodeAt(0);return 32===b?"-":b>=65&&90>=b?""+a.toLowerCase():("000"+b.toString(16)).slice(-4)})},f=function(a,b,c){return Math.min(Math.max(a,b),c)},g=function(a,b){var c,d,e,f,g=a.width/a.height,h=b.width/b.height;g>h?(c=a.width,d=a.width*(1/h),e=a.x,f=a.y-(d-a.height)/2):(d=a.height,c=a.height*h,f=a.y,e=a.x-(c-a.width)/2);var i={width:c,height:d,x:e,y:f};return i},h=function(a,b){var c=b||0;return{x:a.position().left+c,y:a.position().top+c,width:a.width()-2*c,height:a.height()-2*c}},i=function(a,b){var c=h(a),d=h(b),e=g(c,d);b.css({top:e.y,left:e.x,width:e.width,height:e.height})},j=function(a,b){var c,d,e,f,g=a.width/a.height,h=b.width/b.height;h>g?(c=a.width,d=a.width/h,e=a.x+0,f=a.y+(a.height-d)/2):(c=a.height*h,d=a.height,f=a.y+0,e=a.x+(a.width-c)/2);var i={width:c,height:d,x:e,y:f};return i},k=function(a,b){var c=h(a),d=h(b),e=j(c,d);return b.css({top:e.y,left:e.x,width:e.width,height:e.height}),e},l=function(a,b,c){a.complete?c():a.onload=c,b&&(a.src=b)},m=function(a){var b=arguments,c=1;return b.length>1?a.replace(/%((%)|s)/g,function(a){return a[2]||b[c++]}):a},n=function(a){if(console&&console.log){var b=arguments,c=1;console.log(b.length>1?a.replace(/%((%)|s)/g,function(a){return a[2]||b[c++]}):a)}},o=function(){return"ontouchstart"in window||window.navigator.msMaxTouchPoints},p={LEFT_ARROW:37,RIGHT_ARROW:39,DOWN_ARROW:40,UP_ARROW:38,SPACE:32,ENTER:13,ESCAPE:27};a.utils.debounce=d,a.utils.toCssClass=e,a.utils.updateQueryStringParameter=b,a.utils.getQueryStringParameterByName=c,a.utils.Keys=p,a.utils.clamp=f,a.utils.cover=g,a.utils.coverElement=i,a.utils.getElementRect=h,a.utils.contain=j,a.utils.containElement=k,a.utils.onLoadImage=l,a.utils.sprintf=m,a.utils.printf=n,a.utils.supportsTouch=o}(),function(){function b(a,b,c){this.selectAllText=c,this.$el=b.addClass("dropdown"),this.$choices=this.$el,this.$choices.on("change",$.proxy(this.selectionChanged,this)),PxFacetSearch.CategorySelectorUI.call(this,a,b)}b.prototype=Object.create(PxFacetSearch.CategorySelectorUI.prototype),b.prototype.constructor=b,b.prototype.renderChoices=function(){var a,b,c,d,e,f=[],g=this.selectionCount===this.choiceData.length;for(f.push(this.renderChoice(this.selectAllText,g===!0,1)),a=0,b=this.choiceData.length;b>a;a++){if(c=this.choiceData[a],!c.value)return;d=!g&&c.selected,e=this.renderChoice(c.value,d,c.count),e&&f.push(e)}this.$choices.html(f)},b.prototype.renderChoice=function(a,b,c){if(0===c&&!b)return null;var d=$("<option/>").attr("value",a).text(a);return b&&d.attr("selected","selected"),d},b.prototype.selectionChanged=function(){var a=this.$choices.val();a&&a!==this.selectAllText?(this.selector.select([a]),this.selectionCount=1):this.clearSelections()},a.controls.DropdownSelector=b}(),function(b,c){function d(a,c){this.settings=b.extend({},g,c),this._defaults=g,this._name=f,this.container=a,this.$container=b(a),this.mapLow=this.$container.find("#"+this.settings.mapLowId)[0],this.mapHigh=this.$container.find("#"+this.settings.mapHighId)[0],this.hotSpots=this.$container.find("#"+this.settings.hotSpotsId)[0],this.mapLow||(this.mapLow=this.mapHigh),this.mapHigh||(this.mapHigh=this.mapLow),this.container&&this.mapHigh&&this.mapLow&&this.settings.mapWidth&&this.settings.mapHeight&&this.init()}function e(a){this.x=0,this.y=0,this.expandAt=a,this.children=new LinkedList,this.isGroup=!0,this.totalCount=0,this.show=!0}var f="mapZoom",g={mapLowId:"",mapHighId:"",hotSpotsId:"",mapWidth:1e3,mapHeight:1e3,mapLongitudeShift:0,mapLatitudeShift:0,mapResBoundary:.5,maxZoom:2,maxGroupSize:20,mapGroupIncrement:.2,mousewheelSpeed:3,onHotSpotClick:null},h={lat:0,lng:0,show:!0};b.extend(d.prototype,{init:function(){this.$mapLow=b(this.mapLow),this.$mapHigh=b(this.mapHigh),this.$hotSpots=b(this.hotSpots),this.$container.css({overflow:"hidden"}),this.currentScale=1,this.$mapLow.css("transform-origin","0% 0%"),this.$mapHigh.css("transform-origin","0% 0%"),this.$hotSpots.css("transform-origin","0% 0%"),this.$container.on({mousewheel:b.proxy(this.mousewheel,this),pxpinchstart:b.proxy(this.onPinch,this),pxpinchmove:b.proxy(this.onPinch,this),pxdragstart:b.proxy(this.dragstart,this),pxdragmove:b.proxy(this.dragmove,this),pxdragend:b.proxy(this.dragend,this),pxtap:b.proxy(this.tap,this)}),this.reset()},reset:function(){this.map=this.mapLow,this.$map=this.$mapLow,this.naturalWidth=this.settings.mapWidth,this.naturalHeight=this.settings.mapHeight,this.mapAspect=this.naturalWidth/this.naturalHeight,b(c).resize(b.proxy(this.resize,this)),this.resize(),this.zoomToCenter(this.minScale,.5,.5)},getPluginInstance:function(){return b(this).data("plugin_"+f)},resize:function(){this.containerWidth=this.container.clientWidth,this.containerHeight=this.container.clientHeight,this.containerAspect=this.containerWidth/this.containerHeight,this.minScale=this.containerAspect<this.mapAspect?this.containerHeight/this.naturalHeight:this.containerWidth/this.naturalWidth,this.currentScale<this.minScale&&this.zoom(this.minScale),this.isHotSpotGroupsCurrent=!1,this.applyTransform()},mousewheel:function(a){var b=a.deltaY/5e3*this.settings.mousewheelSpeed,c=this.currentScale*(1+b);return this.zoom(c),a.preventDefault(),!1},onPinch:function(b){var c=a.utils.clamp(b.scale,.5,3);this.zoom(c)},dragstart:function(a){this.lastdragX=a.paths[0].startPointer.x,this.lastdragY=a.paths[0].startPointer.y,this.dragTimestamp=Date.now()},velocityX:0,velocityY:0,dragmove:function(a){var b=a.paths[0].movePointer;this.pan(b.x-this.lastdragX,b.y-this.lastdragY);var c=Date.now(),d=c-this.dragTimestamp;this.dragTimestamp=c;var e=50*(b.x-this.lastdragX)/(1+d),f=50*(b.y-this.lastdragY)/(1+d);this.velocityX=e?.8*e+.2*this.velocityX:0,this.velocityY=f?.8*f+.2*this.velocityY:0,this.lastdragX=b.x,this.lastdragY=b.y},dragend:function(){this.lastdragX+this.velocityX,this.lastdragY+this.velocityY},tap:function(a){var c=b(a.originalEvent.target),d=c.length&&c.hasClass("mapHotSpotGroup"),e=c.length&&c.hasClass("mapHotSpot")&&!d;if(this.settings.onHotSpotClick&&(e||d)){if(a.isHotSpot=e,a.isHotSpotGroup=d,a.hotSpots=[],e)a.hotSpots.push(c.data("hotSpot"));else{var f=c.data("hotSpot");f.children.eachDeep(function(b,c){c.isGroup||a.hotSpots.push(c)})}this.settings.onHotSpotClick(a)}},calculateMapCenterOffset:function(a,b){var c=b*(1/this.currentScale),d=(this.naturalWidth*a-c)/this.naturalWidth;return d},calculateScreenOffset:function(a,b,c){return Math.round(b-a*c)},zoom:function(a){this.zoomToCenter(a,this.currentMapCenterX,this.currentMapCenterY)},pan:function(a,b,c,d){var e=this.calculateMapCenterOffset(this.currentMapCenterX,a),f=this.calculateMapCenterOffset(this.currentMapCenterY,b);this.zoomToCenter(this.currentScale,e,f,c,d)},zoomToCenter:function(d,e,f,g,h){d=a.utils.clamp(d,this.minScale,this.settings.maxZoom);var i=Math.abs(this.containerWidth-this.naturalWidth*d)/(this.naturalWidth*d),j=Math.abs(this.containerHeight-this.naturalHeight*d)/(this.naturalHeight*d);e=a.utils.clamp(e,.5-i/2,.5+i/2),f=a.utils.clamp(f,.5-j/2,.5+j/2),this.isHotSpotGroupsCurrent=this.currentScale===d,this.currentMapCenterX=e,this.currentMapCenterY=f,this.currentScale=d,this.ampX=g,this.ampY=h;var k=this.calculateScreenOffset(this.naturalWidth*e,this.containerWidth/2,d),l=this.calculateScreenOffset(this.naturalHeight*f,this.containerHeight/2,d);this.currentOffsetX=k,this.currentOffsetY=l,this.isUpdatePending||(this.isUpdatePending=!0,c.requestAnimationFrame(b.proxy(this.applyTransform,this)));var m=this;clearTimeout(this.manipulateCompleteTimeout),this.manipulateCompleteTimeout=setTimeout(function(){m.currentScale>m.settings.mapResBoundary&&(m.map=m.mapHigh,m.$map=m.$mapHigh,m.$mapHigh.show(),m.$mapLow.hide(),m.applyTransform()),!m.isHotSpotGroupsCurrent},50),this.currentScale<=this.settings.mapResBoundary&&(this.map=this.mapLow,this.$map=this.$mapLow,this.$mapHigh.hide(),this.$mapLow.show())},applyTransform:function(){if(this.ampX||this.ampY){var a=Date.now()-this.dragTimestamp;-this.ampX*Math.exp(-a/325)}else{this.isUpdatePending=!1;var b="translate("+this.currentOffsetX+"px, "+this.currentOffsetY+"px) scale("+this.currentScale+")";this.$map.css("transform",b),this.updateHotSpotElements()}},latLongToMercator:function(a,b){var c=this.settings.mapWidth*(180+b)/360%this.settings.mapWidth+this.settings.mapLongitudeShift;a=a*Math.PI/180;var d=Math.log(Math.tan(a/2+Math.PI/4));return d=this.settings.mapHeight/2-this.settings.mapWidth*d/(2*Math.PI)+this.settings.mapLatitudeShift,{x:c,y:d}},hotSpotsCollection:{},addHotSpot:function(a,c){var d=b.extend({},h,c),e=this.latLongToMercator(d.lat,d.lng);d.key=a,d.x=e.x,d.y=e.y,this.hotSpotsCollection[a]=d,this.debounceRecalculateHotSpotGroups(),this.debounceRenderHotSpotGroups()},toggleHotSpotByKey:function(a,b){var c=this.hotSpotsCollection[a];c&&(c.show=b,this.debounceRecalculateHotSpotGroups(),this.debounceRenderHotSpotGroups())},hideHotSpotIntoGroup:function(a){a.isVisible=!1,a.$el.css("opacity",.1)},showHotSpotFromGroup:function(a){a.isVisible=!0,a.$el.css("opacity",1)},updateHotSpotElements:function(){(!this.scaleAtLastRender||Math.abs(this.scaleAtLastRender-this.currentScale)>this.settings.mapGroupIncrement)&&this.debounceRenderHotSpotGroups();var a=this;b(".mapHotSpot").each(function(){var c=b(this),d=b(this).data("hotSpot");d&&c.css({left:d.x*a.currentScale+a.currentOffsetX,top:d.y*a.currentScale+a.currentOffsetY})})},debounceRenderHotSpotGroups:function(){this._debounceRender||(this._debounceRender=a.utils.debounce(this.renderHotSpotGroups,50)),this._debounceRender()},renderHotSpotGroups:function(){if(this.scaleAtLastRender=this.currentScale,this.hotSpotGroups){this.$hotSpots.empty();var a=[],c=this,d=function(b){b.children.each(function(b,e){e.expandAt?e.expandAt<=c.currentScale?d(e):a.push(e):e.show&&a.push(e)})};d(this.hotSpotGroups);for(var e=0;e<a.length;e++){var f=a[e],g=f.children?!0:!1,h=g?"mapHotSpot mapHotSpotGroup mapGroupCount-"+f.totalCount:"mapHotSpot",i=f.x*c.currentScale+c.currentOffsetX,j=f.y*c.currentScale+c.currentOffsetY,k=b('<div class="'+h+'" style="left:'+i+"px; top:"+j+'px"></div>').appendTo(this.$hotSpots);k.data("hotSpot",f)}}},debounceRecalculateHotSpotGroups:function(){this._debouncedRecalc||(this._debouncedRecalc=a.utils.debounce(b.proxy(this.recalculateHotSpotGroups,this),50)),this._debouncedRecalc()},recalculateHotSpotGroups:function(){var a=this.settings.maxZoom,b=this.settings.maxGroupSize,c=new e(a);for(var d in this.hotSpotsCollection)c.children.add(this.hotSpotsCollection[d]);for(;a>0;){for(var f=c.children.head;f;){for(var g=f.data,h=c.children.head;h;){var i=h.next,j=h.data;if(j!==g&&g.show&&j.show){var k=a*this.distanceBetweenHotSpots(g,j);if(b>k){if(g.isGroup&&g.expandAt===a)g.children.add(j),i&&null===i.next&&(this.testNext=!0);else{var l=new e(a),m=c.children.replace(f,l);l.children.add(g),l.children.add(j),g=l,f=m}c.children.remove(h),g.updateCoordinates()}}h=i}f=f.next}a-=this.settings.mapGroupIncrement}c.updateTotalCounts(),this.hotSpotGroups=c},distanceBetweenHotSpots:function(a,b){var c=b.x-a.x;c*=c;var d=b.y-a.y;return d*=d,Math.sqrt(c+d)}}),b.fn[f]=function(a){return this.each(function(){b.data(this,"plugin_"+f)||b.data(this,"plugin_"+f,new d(this,a))}),this},b.fn.getMapZoom=function(){var a=[];return this.each(function(){var c=b.data(this,"plugin_"+f);c&&a.push(c)}),a},e.prototype.updateCoordinates=function(){var a=0,b=0;this.children.each(function(c,d){a+=d.x,b+=d.y}),this.x=Math.round(a/this.children.length),this.y=Math.round(b/this.children.length)},e.prototype.updateTotalCounts=function(){var a=function(b){var c=0;return b.children.each(function(b,d){d.isGroup?(d.totalCount=a(d),c+=d.totalCount):c++}),c};this.totalCount=a(this)},e.prototype.print=function(){this.children.eachDeep(function(a,b,c){for(var d="",e=b.children?!0:!1,f=0;4*c>f;f++)d+=" ";d+=e?"GROUP (expandAt: "+b.expandAt+", totalcount: "+b.totalCount+"x: "+b.x+", y: "+b.y+")":"SPOT (x: "+b.x+", y: "+b.y+", closest: "+b.closest,console.log(d)})}}(jQuery,window,document),function(){function b(a,b){return this.video=b,this.$video=$(b),this.$el=a,this.$play=a.find(".mpPlay"),this.$mute=a.find(".mpMute"),this.$track=a.find(".mpTrack"),this.$progress=a.find(".mpProgress"),this.$currentTime=a.find(".mpCurrentTime"),this.$totalTime=a.find(".mpTotalTime"),this.init(),this}var c=function(a){var b=new Date(1970,0,1);return b.setSeconds(a),b.toTimeString().replace(/.*(\d{2}:\d{2}).*/,"$1")};b.prototype.init=function(){this.isSeeking=!1,this.isPlaying=!1,this.hideTimeout=null,this.proxyTogglePlayPause=$.proxy(this.togglePlayPause,this),this.proxyMute=$.proxy(this.toggleMute,this),this.proxyShowControls=$.proxy(this.showControls,this),this.proxySeekDown=$.proxy(this.seekDown,this),this.proxyOnPlay=$.proxy(this.onPlay,this),this.proxyOnPause=$.proxy(this.onPause,this),this.proxyOnTimeUpdate=$.proxy(this.onTimeUpdate,this),this.proxyOnLoadMetadata=$.proxy(this.onLoadMetaData,this),this.video.addEventListener("play",this.proxyOnPlay),this.video.addEventListener("pause",this.proxyOnPause),this.video.addEventListener("timeupdate",this.proxyOnTimeUpdate),this.$video.on("click",this.proxyTogglePlayPause),this.$play.on("click",this.proxyTogglePlayPause),this.$mute.on("click",this.proxyMute),this.$video.on("mousemove",this.proxyShowControls),this.$track.on("mousedown",this.proxySeekDown),this.updateHideControls(),this.setProgress(0),this.updateAudioState();var a=setInterval($.proxy(function(){this.video&&4===this.video.readyState&&(clearInterval(a),this.isPlaying||this.setProgress(0))},this),200)},b.prototype.release=function(){this.video.removeEventListener("play",this.proxyOnPlay),this.video.removeEventListener("pause",this.proxyOnPause),this.video.removeEventListener("timeupdate",this.proxyOnTimeUpdate),this.$video.off("click",this.proxyTogglePlayPause),this.$play.off("click",this.proxyTogglePlayPause),this.$mute.off("click",this.proxyMute),this.$video.off("mousemove",this.proxyShowControls),this.$track.off("mousedown",this.proxySeekDown)},b.prototype.togglePlayPause=function(){this.isPlaying?this.pause():this.play()},b.prototype.play=function(){this.isPlaying||this.video.play()},b.prototype.pause=function(){this.isPlaying&&this.video.pause()},b.prototype.showVideoControls=function(){this.updateHideControls(!0)},b.prototype.updateHideControls=function(a){this.hideTimeout&&clearTimeout(this.hideTimeout),a&&this.$el.removeClass("hideControls"),this.hideTimeout=setTimeout($.proxy(function(){this.isPlaying&&!this.isSeeking&&this.$el.addClass("hideControls")},this),2e3)},b.prototype.toggleMute=function(){var b=!a.settings.getSoundEnabled();a.settings.setSoundEnabled(b),this.updateAudioState()},b.prototype.updateAudioState=function(){var b=!a.settings.getSoundEnabled();this.video.muted=b,this.$el.toggleClass("muted",b)},b.prototype.showControls=function(){this.updateHideControls(!0)},b.prototype.seekDown=function(a){function b(a){var b=Math.max(0,Math.min(d,a.pageX-c));f=b/d,e.$progress.css("width",100*f+"%")}this.isSeeking=!0;var c=this.$track.offset().left,d=this.$track.width(),e=this,f=null;b(a),$(document).bind({mousemove:b,mouseup:$.proxy(function(){if(f&&e.video&&e.video.duration){var a=Math.round(f*e.video.duration);e.doSeek(a)}$(document).unbind("mousemove"),$(document).unbind("mouseup")},this)})},b.prototype.doSeek=function(a){a=Math.max(0,a),this.video.currentTime=a,this.isSeeking=!1,this.updateHideControls(!1)},b.prototype.onTimeUpdate=function(){if(!this.isSeeking&&this.video.currentTime&&this.video.duration){var a=this.video.currentTime/this.video.duration;this.setProgress(a)}},b.prototype.setProgress=function(a){a>.99?(this.$progress.css("width","100%"),this.$el.addClass("complete")):(this.$progress.css("width",100*a+"%"),this.$el.removeClass("complete"));var b=this.video.currentTime?c(this.video.currentTime):"00:00",d=this.video.duration?c(this.video.duration):"00:00";this.$currentTime.text(b),this.$totalTime.text(d)},b.prototype.onPlay=function(){console.log("onplay"),this.isPlaying=!0,this.$el.addClass("playing"),this.updateHideControls()},b.prototype.onPause=function(){console.log("onpause"),this.isPlaying=!1,this.$el.removeClass("playing"),this.updateHideControls(!0)},a.controls.MediaControls=b}(),function(){function b(a){return this.$el=a,this.$outer=a.find(".mpMediaOuter"),this.$media=a.find(".mpMedia"),this.$overlay=a.find(".mpOverlay"),this.$close=a.find(".mpClose"),this.$loader=a.find(".mpLoader"),this.$mediaControls=a.find(".mpPlayerControls"),this.$thumbs=a.find(".mpThumbs"),this.sizes={},this.controls=null,this.init(),this}var c=60,d=10,e=40,f=92,g={Left:-1,Right:1},h=function(a,b){return(b?".":"")+"mpMediaItem"+a},i=function(a,b){var c="";return a.thumb?c=a.thumb:a.poster?c=a.poster:"image"===a.type&&(c=a.content),b?"url('"+c+"')":c};b.prototype.init=function(){this.$overlay.click($.proxy(this.close,this)),this.$close.click($.proxy(this.close,this)),$(document.body).on({keydown:$.proxy(this._onKeyDown,this)}),$(window).resize($.proxy(function(){this._resizeMedia()},this))},b.prototype.show=function(a,b){this.items=a,this.showing=!0,1===a.length?(b=0,this.gallery=!1,this.thumbRowHeight=0):(this.$el.addClass("mpGallery"),this.gallery=!0,this.thumbRowHeight=this.$thumbs.height(),this.$thumbs.empty(),$.each(a,$.proxy(function(a,b){var c=$('<div class="mpThumb"></div>').css("background-image",i(b,!0)).appendTo(this.$thumbs);c.click($.proxy(this._onThumbClick,this))},this))),this.$loader.removeClass("stop"),this.$loader.delay(1e3).fadeIn(400),this.$el.fadeIn(400,$.proxy(function(){this._showItem(b)},this))},b.prototype.next=function(){if(this.gallery){var a=this.currentIndex===this.items.length-1?0:this.currentIndex+1;this._hideItem(this.currentIndex,g.Left),this._showItem(a,g.Right)}},b.prototype.previous=function(){if(this.gallery){var a=0===this.currentIndex?this.items.length-1:this.currentIndex-1;this._hideItem(this.currentIndex,g.Right),this._showItem(a,g.Left)}},b.prototype.close=function(){this.showing=!1,this._hideItem(this.currentIndex),this.$el.fadeOut(400,$.proxy(function(){this.$media.empty(),this.$thumbs.fadeTo(0,0),this.$thumbs.empty().removeClass("hidePreviews"),this.$loader.stop().hide()},this))},b.prototype._showItem=function(a,b){this.currentIndex=a,b=b||0;var c=this.items[a],d=c.content,f=c.type,g=c.width,i=c.height,j=c.poster,k=c.description?c.description:c.caption,l=c.mainText;c||this.close();var m=$('<div class="mpMedia mpMedia-'+f+" "+h(a)+'"></div>').css("opacity",0).prependTo(this.$outer);k&&m.append('<div class="mpCaption"><div class="mpCaptionContent">'+k+"</div></div>"),l&&$('<div class="mpMainText"/>').text(l).appendTo(m),this.gallery&&this.$thumbs.children().removeClass("selected").eq(a).addClass("selected");var n=function(a){m.css({x:e*b});var c=i?i:a.height?a.height:600,d=g?g:a.width?a.width:600;this._resizeMedia(m,d,c),this.$loader.stop(!0).fadeOut(400,function(){$(this).addClass("stop")}),setTimeout($.proxy(function(){m.transition({x:0,opacity:1},300,$.proxy(function(){this.controls&&this.$mediaControls.delay(200).fadeIn(800),this.$close.delay(200).fadeIn(800)},this))},this),200)};switch(this.$loader.stop(!0).delay(300).removeClass("stop").fadeIn(400),f){case"image":this._addImage(m,d,$.proxy(n,this));break;case"video":this._addVideo(m,d,j,$.proxy(n,this));break;case"audio":this._addImage(m,j,$.proxy(n,this)),this._addAudio(m,d);break;case"3d":this._addIframe(m,c.url,$.proxy(n,this));break;case"tour":this._addIframeTour(m,c.url,$.proxy(n,this))}},b.prototype._hideItem=function(a,b,c){b=b||0,this.$close.stop().hide(),this.$mediaControls.stop().hide(),this.controls&&(this.controls.release(),this.controls=null);var d=this.$outer.find(h(a,!0));d.delay(50).transition({x:e*b,opacity:0},300,$.proxy(function(){d.remove(),c&&c()},this))},b.prototype._resizeMedia=function(b,e,g){if(b=b||this.$lastElement||$(),e=e||this.lastWidth,g=g||this.lastHeight,b){this.$lastElement=b,this.lastWidth=e,this.lastHeight=g;var h={width:this.$el.width()-2*c,height:this.$el.height()-(2*c+this.thumbRowHeight),x:c,y:c},i={width:e,height:g};b.hasClass("mpMedia-tour")&&(h={width:e,height:g,x:(this.$el.width()-e)/2,y:c});var j=a.utils.contain(h,i);console.log(e+" / "+h.width+" / "+j.width),b.css({width:Math.round(j.width),height:Math.round(j.height),top:Math.round(j.y),left:Math.round(j.x)}),this.$close.css({top:Math.round(j.y)+d,left:Math.round(j.x+j.width)-(d+this.$close.width())}),this.$mediaControls.css({top:Math.round(j.y+j.height)-(d+this.$mediaControls.height()),left:Math.round(j.x+(j.width-this.$mediaControls.width())/2)}),this.gallery&&this.$thumbs.toggleClass("hidePreviews",this.items.length>Math.floor(.9*this.$el.width()/f)).fadeTo(100,1)}},b.prototype._addImage=function(a,b,c){var d=new Image;d.onload=$.proxy(function(){var e=$('<img src="'+b+'" />').appendTo(a),f={element:e[0],width:d.width,height:d.height};c&&c(f)},this),d.src=b},b.prototype._addVideo=function(b,c,d,e){var f=$('<video poster="'+d+'"><source src="'+c+'.webm" type="video/webm"></source><source src="'+c+'.mp4" type="video/mp4"></source></video>').appendTo(b);this.controls=new a.controls.MediaControls(this.$mediaControls,f[0],{autoPlay:!0});var g=function(a,b){if(e){var c={element:f[0],width:a,height:b};e(c)}};if(c in this.sizes)g(this.sizes[c].width,this.sizes[c].height);else{var h=this;f[0].onloadedmetadata=function(){g(this.videoWidth,this.videoHeight),h.sizes[c]={width:this.videoWidth,height:this.videoHeight}}}},b.prototype._addAudio=function(b,c){var d=$('<audio><source src="'+c+'" type="audio/mp3"></source></audio>').appendTo(b);return this.controls=new a.controls.MediaControls(this.$mediaControls,d[0],{autoPlay:!0}),d},b.prototype._addIframe=function(a,b,c){var d=$("<iframe/>").attr("src",b).appendTo(a);c({element:d.get(0),width:1600,height:900})},b.prototype._addIframeTour=function(a,b,c){var d=$("<iframe/>").attr("src",b).appendTo(a);c({element:d.get(0),width:400,height:400})},b.prototype._onKeyDown=function(b){if(this.showing)switch(b.keyCode){case a.utils.Keys.RIGHT_ARROW:case a.utils.Keys.SPACE:case a.utils.Keys.DOWN_ARROW:this.next();break;case a.utils.Keys.LEFT_ARROW:case a.utils.Keys.UP_ARROW:this.previous();break;case a.utils.Keys.ESCAPE:this.close()}},b.prototype._onThumbClick=function(a){var b=$(a.target).index();this._hideItem(this.currentIndex,g.Left),this._showItem(b)},a.controls.MediaPopup=b}(),function(){function b(b,d){PxFacetSearch.View.call(this,b),this.sorter=new a.controls.NewsSearchSorter,this.map=d,this.currentView="map",this.pageSize=Number.MAX_VALUE,this.visibleCount=this.pageSize,this.query.onUpdate(c.bind(this)),this.render()}function c(){$("html,body").scrollTop(0),this.visibleCount=this.pageSize,this.render()}var d={grid:"grid",map:"map"};b.prototype=Object.create(PxFacetSearch.View.prototype),b.prototype.constructor=b,b.prototype.resize=function(){this.currentView===d.grid&&(this.grid.resize(),this.grid.redraw(!0))},b.prototype.setViewType=function(a){a!==this.currentView&&(this.currentView=a,this.render())},b.prototype.createCheckboxClickHandler=function(){},b.prototype.render=function(){var b=this.sortedMatchIds,c=Math.min(b.length,this.visibleCount),d=b.slice(0,c);if(b.length>=1){$(".storyItem").hide();for(var e=0;e<d.length;e++)$("."+a.table.getValue("news_ID_pretty",d[e])).show()}else $(".storyItem").show()},a.controls.NewsBrowseView=b}(),function(){function b(a,b){this.query="",this.filterName=b,this.searchResults={},this.newsIdIndices=null;var c=_.debounce(_.bind(this.startSearch,this),300);this.$el=a.on("change keyup input",_.bind(function(a){13===a.keyCode?this.startSearch():c()},this)),""!==this.$el.val()&&this.startSearch()}function c(){this.searchMatchIds=null}function d(a,b){this.searchResults=b,PxFacetSearch.Filter.call(this,a)}b.prototype.startSearch=function(){this.query=this.$el.val(),!this.query||this.searchResults[this.query]?this.updateView(this.query):$.ajax({dataType:"json",url:"/api/news/search?q="+encodeURIComponent(this.query),success:this.createResultsHandler(this.query)})},b.prototype.ensureNewsIdLookup=function(){if(!this.newsIdIndices){this.newsIdIndices={};var b,c,d=a.table.getColumn("news_ID").values;for(b=0,c=d.length;c>b;b++)this.newsIdIndices[d[b]]=b}},b.prototype.updateView=function(b){var c=b?this.searchResults[b]:null;a.view.sorter.searchMatchIds=c,a.view.query.select(this.filterName,b)},b.prototype.createResultsHandler=function(a){return $.proxy(function(b){this.ensureNewsIdLookup();var c,d,e,f=[];for(c=0,d=b.length;d>c;c++)e=this.newsIdIndices[b[c]],e>=0&&f.push(e);this.searchResults[a]=f,this.query===a&&this.updateView(a)},this)},c.prototype.sortIds=function(a){if(!this.searchMatchIds)return a;var b=a.slice();return b.sort($.proxy(this.compareIdsBySearchResultIndex,this)),b},c.prototype.compareIdsBySearchResultIndex=function(a,b){if(!this.searchMatchIds)return 0;var c=this.searchMatchIds.indexOf(a),d=this.searchMatchIds.indexOf(b);return d>c?-1:c>d?1:0},d.prototype=Object.create(PxFacetSearch.Filter.prototype),d.prototype.constructor=d,d.prototype.select=function(a){var b,c,d,e,f=a?this.searchResults[a]||[]:[],g=[],h=[];for(b=0,c=this.matches.length;c>b;b++)d=this.matches[b],e=f.indexOf(b)>=0||!a,d!==e&&(d?g.push(b):h.push(b));return this.updateSelections(h,g)},a.controls.NewsSearchBox=b,a.controls.NewsSearchFilter=d,a.controls.NewsSearchSorter=c}(),function(){function b(b){PxFacetSearch.View.call(this,b),this.sorter=new a.controls.ProjectSearchSorter,this.currentView="grid",this.grid=new a.controls.ProjectGrid(document.getElementById("grid")),this.map=new a.controls.ProjectMap(document.getElementById("map")),this.pageSize=Number.MAX_VALUE,this.visibleCount=this.pageSize;var d=this.getSelector("country");d.choiceSortCompare=d.compareChoicesByValue;var e=this.getSelector("culture");e.choiceSortCompare=e.compareChoicesByValue;var f=this.getSelector("theme");f.choiceSortCompare=f.compareChoicesByValue,this.selectionControls=[new a.controls.DropdownSelector(e,$("#cultures"),a.strings.allCultures),new a.controls.DropdownSelector(d,$("#countries"),a.strings.allCountries),new a.controls.DropdownSelector(f,$("#themes"),a.strings.allThemes)],$("#cyark500Checkbox").on("click",this.createCheckboxClickHandler("cyark500")),this.query.onUpdate(c.bind(this)),this.render()}function c(a){var b,c,d;for(b=0,c=this.selectionControls.length;c>b;b++)d=this.selectionControls[b],d.selector.name!==a&&d.updateData();$("html,body").scrollTop(0),this.visibleCount=this.pageSize,this.render()}var d={grid:"grid",map:"map"};b.prototype=Object.create(PxFacetSearch.View.prototype),b.prototype.constructor=b,b.prototype.resize=function(){this.currentView===d.grid&&(this.grid.resize(),this.grid.redraw(!0))},b.prototype.setViewType=function(a){a!==this.currentView&&(this.currentView=a,this.render())},b.prototype.createCheckboxClickHandler=function(a){var b=this.getSelector(a),c=function(a){var c=$(a.currentTarget),d=($(a.target),c.toggleClass("selected").hasClass("selected"));d?b.select(["true"]):b.reset()};return c},b.prototype.render=function(){var a=this.sortedMatchIds,b=Math.min(a.length,this.visibleCount),c=a.slice(0,b);this.currentView===d.grid?(this.grid.updateTiles(c),this.grid.redraw(!0),this.map.hideMapHint()):this.currentView===d.map&&(this.map.updateVisibleIds(c),this.map.redraw())},a.controls.ProjectBrowseView=b}(),function(){function b(b){Tiles.Grid.call(this,b),this.cellPadding=0,this.cellAspectRatio=400/255,this.cellWidthMin=360,this.templateFactory=a.controls.ProjectGridLayout,this.appendDelay=0,this.appendDelayIncrement=20}b.prototype=Object.create(Tiles.Grid.prototype),b.prototype.constructor=b,b.prototype.createTile=function(b){var c=new a.controls.ProjectTile(b);return c},b.prototype.redraw=function(a,b){this.appendDelay=0,Tiles.Grid.prototype.redraw.call(this,a,b)},b.prototype.getAppendDelay=function(){return this.appendDelay+=this.appendDelayIncrement,this.appendDelay},a.controls.ProjectGrid=b}(),function(){var b=[{columnCount:2,tileCount:2,layout:[". ."]},{columnCount:3,tileCount:15,layout:["B B .","B B .",". . .",". A A",". A A",". . .",". . ."]},{columnCount:4,tileCount:32,layout:["B B . .","B B . .",". . A A",". . A A",". . . .","B B . .","B B . .",". . . .",". A A .",". A A .",". . . ."]},{columnCount:5,tileCount:53,layout:[". . A A .",". . A A .",". . . . .","B B . . .","B B . . .",". . . . .",". . . A A",". . . A A",". . . . .",". B B . .",". B B . .",". . . . .",". . . . ."]},{columnCount:6,tileCount:54,layout:[". . . A A .",". . . A A .",". . . . . .","B B . . . .","B B . . . .",". . . . A A",". . . . A A",". B B . . .",". B B . . .",". . . . . .",". . . . . ."]},{columnCount:7,tileCount:65,layout:[". . . . A A .",". . . . A A .",". . . . . . .","B B . . . . .","B B . . . . .",". . . . . A A",". . . . . A A",". . . . . . .",". B B . . . .",". B B . . . .",". . . . . . ."]},{columnCount:8,tileCount:110,layout:["B B . . . A A A","B B . . . A A A",". . . . . A A A","B B . . . . . .","B B . . . . . .",". . . . . . . .",". . . . . A A .",". . . . . A A .",". B B B . . . .",". B B B . . C C",". B B B . . C C",". . . . . . . .","C C . . A A . .","C C . . A A . .",". . . . . . D D",". B B . . . D D",". B B . . . . .",". . . . . . . ."]}],c={get:function(a,c){for(var d=null,e=Math.ceil(c/a),f=0;f<b.length;f++)b[f].columnCount===a&&(d=b[f]);
if(d){for(var g=[],h=0;c>h;){h+=d.tileCount;for(var i=0;i<d.layout.length;i++)g.push(d.layout[i])}var j=Tiles.Template.fromJSON(g);return j}var k,l,m=[];for(l=0;e>l;l++)for(k=0;a>k;k++)m.push(new Tiles.Rectangle(k,l,1,1));return new Tiles.Template(m,a,e)}};a.controls.ProjectGridLayout=c}(),function(){function b(a){this.$el=$(a).mapZoom({mapLowId:"mapImgLow",mapHighId:"mapImgHigh",mapWidth:6e3,mapHeight:4108,mapLongitudeShift:4,mapLatitudeShift:812,mapResBoundary:.5,maxZoom:1.8,maxGroupSize:20,hotSpotsId:"mapHotSpots",onHotSpotClick:$.proxy(this.hotSpotClick,this)}),this.mapzoom=this.$el.getMapZoom()[0],this.$mapHintOuter=$("#mapHintOuter").on("click",$.proxy(this.mapHintOuterClick,this)).on("click",".mapHintSelectorDot",$.proxy(this.selectMapHint,this)),this.addMapPoints()}b.prototype.addMapPoints=function(){var b,c,d,e,f;for(b=0,c=a.table.itemCount;c>b;b++)d=a.table.getValue("latitude",b),e=a.table.getValue("longitude",b),d&&e&&(f="mp"+b,this.mapzoom.addHotSpot(f,{lat:d,lng:e}))},b.prototype.updateVisibleIds=function(b){var c,d,e,f;for(c=0,d=a.table.itemCount;d>c;c++)f=b.indexOf(c)>=0,e="mp"+c,this.mapzoom.toggleHotSpotByKey(e,f)},b.prototype.redraw=function(){var a=this.mapzoom;setTimeout(function(){a.reset()},50)},b.prototype.hotSpotClick=function(b){var c=$(b.originalEvent.target);if(c.length){var d=$("#mapHint"),e=$("#mapHintInner"),f=$("#mapHintSelector"),g=10,h=8,i=-12;e.css("left","0px"),e.empty(),f.empty(),d.toggleClass("mapHintGroup",b.hotSpots.length>1);for(var j=0;j<b.hotSpots.length;j++){var k=parseInt(b.hotSpots[j].key.replace("mp",""),10),l=a.table.getValue("prettyId",k),m=$('<a href="/projects/'+l+'" ></a>').appendTo(e),n=a.controls.ProjectTile.renderInto(m,k),o={width:d.width(),height:d.height()};a.controls.ProjectTile.updateThumbnail(n,k,a.controls.ThumbSize.LOW,o),f.append('<div class="mapHintSelectorDot" />')}$(".mapHintSelectorDot").eq(0).addClass("selected");var p=c.offset();this.$mapHintOuter.fadeIn(100),setTimeout($.proxy(function(){var c=b.hotSpots.length>1?g:h,f=c+p.left-d.width()/2,j=i+p.top-d.height();f=a.utils.clamp(f,0,this.$mapHintOuter.width()-d.width()),j=a.utils.clamp(j,parseInt($("#projects").css("top"),10),this.$mapHintOuter.height()-d.height()),d.css({left:f+"px",top:j+"px"}),e.css({width:d.width()*b.hotSpots.length+"px"})},this),0)}},b.prototype.mapHintOuterClick=function(a){"mapHintOuter"===a.target.id&&this.hideMapHint()},b.prototype.hideMapHint=function(){this.$mapHintOuter.fadeOut(100)},b.prototype.selectMapHint=function(a){var b=$(a.currentTarget).index(),c=$("#mapHint").width(),d=b*c*-1;$("#mapHintInner").animate({left:d+"px"},400,"easeInOutQuart"),$(".mapHintSelectorDot").removeClass("selected").eq(b).addClass("selected")},a.controls.ProjectMap=b}(),function(){function b(a,b){this.query="",this.filterName=b,this.searchResults={},this.projectIdIndices=null;var c=_.debounce(_.bind(this.startSearch,this),300);this.$el=a.on("change keyup input",_.bind(function(a){13===a.keyCode?this.startSearch():c()},this)),""!==this.$el.val()&&this.startSearch()}function c(){this.searchMatchIds=null}function d(a,b){this.searchResults=b,PxFacetSearch.Filter.call(this,a)}b.prototype.startSearch=function(){this.query=this.$el.val(),!this.query||this.searchResults[this.query]?this.updateView(this.query):$.ajax({dataType:"json",url:"/api/projects/search?q="+encodeURIComponent(this.query),success:this.createResultsHandler(this.query)})},b.prototype.ensureProjectIdLookup=function(){if(!this.projectIdIndices){this.projectIdIndices={};var b,c,d=a.table.getColumn("id").values;for(b=0,c=d.length;c>b;b++)this.projectIdIndices[d[b]]=b}},b.prototype.updateView=function(b){var c=b?this.searchResults[b]:null;a.view.sorter.searchMatchIds=c,a.view.query.select(this.filterName,b)},b.prototype.createResultsHandler=function(a){return $.proxy(function(b){this.ensureProjectIdLookup();var c,d,e,f=[];for(c=0,d=b.length;d>c;c++)e=this.projectIdIndices[b[c]],e>=0&&f.push(e);this.searchResults[a]=f,this.query===a&&this.updateView(a)},this)},c.prototype.sortIds=function(a){if(!this.searchMatchIds)return a;var b=a.slice();return b.sort($.proxy(this.compareIdsBySearchResultIndex,this)),b},c.prototype.compareIdsBySearchResultIndex=function(a,b){if(!this.searchMatchIds)return 0;var c=this.searchMatchIds.indexOf(a),d=this.searchMatchIds.indexOf(b);return d>c?-1:c>d?1:0},d.prototype=Object.create(PxFacetSearch.Filter.prototype),d.prototype.constructor=d,d.prototype.select=function(a){var b,c,d,e,f=a?this.searchResults[a]||[]:[],g=[],h=[];for(b=0,c=this.matches.length;c>b;b++)d=this.matches[b],e=f.indexOf(b)>=0||!a,d!==e&&(d?g.push(b):h.push(b));return this.updateSelections(h,g)},a.controls.ProjectSearchBox=b,a.controls.ProjectSearchFilter=d,a.controls.ProjectSearchSorter=c}(),function(){function b(a){return Math.abs(a)+" "+(0>a?CyArk.strings.BCE:CyArk.strings.CE)}function c(b){Tiles.Tile.call(this,b,document.createElement("a"));var e=a.table.getValue("prettyId",b);this.$el.data("tileId",b).attr("href","/projects/"+e),this.thumbSize=d.NONE,this.$bg=c.renderInto(this.$el,parseInt(b,10))}var d={NONE:"none",LOW:"low",MEDIUM:"med"};c.prototype=Object.create(Tiles.Tile.prototype),c.prototype.constructor=c,c.prototype.resize=function(a,b,e,f,g){var h=this.thumbSize;a.width>1?this.thumbSize!==d.MEDIUM&&(this.thumbSize=d.MEDIUM):this.thumbSize===d.NONE&&(this.thumbSize=d.LOW),h!==this.thumbSize?c.updateThumbnail(this.$bg,this.id,this.thumbSize,b):c.resizeBackground(this.$bg,b),Tiles.Tile.prototype.resize.call(this,a,b,e,f,g)},c.compareById=function(a,b){return a.id<b.id?-1:a.id>b.id?1:0},c.renderInto=function(c,d){c.addClass("tile").attr("tabindex",0);var e=$('<img class="tileBg" oncontextmenu="return false;" />').css("opacity",0).appendTo(c),f=d,g=a.table.getValue("projectName",f),h=a.table.getValue("country",f),i=a.table.getValue("timeRange",f),j=a.table.getValue("shortDescription",f),k=i[0],l=i[1],m="";a.table.getValue("inProduction",f)&&c.addClass("inProduction"),a.table.getValue("isHeritageSite",f)&&c.addClass("isHeritageSite"),k>0&&l>0&&(k!==l&&(m+=b(k)+" - "),m+=b(l));var n=$('<div class="tileInfo" />').append($('<div class="tileCountry" />').text(h)).append($('<div class="tileName" />').text(g)).append($('<div class="tileDesc" />').html('<span class="tileTime">'+m+"</span> "+j));return $('<div class="tileBar" />').append(n).appendTo(c),a.table.getValue("cyark500",f)&&c.append('<div class="tile500"></div>'),a.table.getValue("chapterCounts",f)||c.append('<div class="tileInProduction">In development</div>'),e},c.resizeBackground=function(b,c){var d=a.utils.cover(c,{width:b.width(),height:b.height()});b.css({width:d.width,height:d.height}).css("opacity",1)},c.updateThumbnail=function(b,d,e,f){var g=a.table.getValue("image",d)||"";"med"===e&&(g=g.replace("_h230_w360.jpg","_h460_w720.jpg"));var h=function(){c.resizeBackground(b,f)};h(),b.off("load").on("load",h),g&&b.attr("src",g)},a.controls.ProjectTile=c,a.controls.ThumbSize=d}(),function(){function b(a,b,c){var d=new H.service.Platform({app_id:"99c7cku76tY5vKgYRvXA",app_code:"LpveZb3HShRsFxEXcrht8w"}),e=d.createDefaultLayers(),f=document.getElementById("mapContainer");this.map=new H.Map(f,e.satellite.xbase,{zoom:c,center:{lng:b,lat:a},zIndex:-1}),this.x=10;var g=new H.mapevents.MapEvents(this.map);new H.mapevents.Behavior(g),this.ui=H.ui.UI.createDefault(this.map,e);var h=this.map;window.addEventListener("resize",function(){h.getViewPort().resize()}),$("#onoffswitchMapType").click(function(){h.setBaseLayer($("#onoffswitchMapType").is(":checked")?e.satellite.map:e.satellite.xbase)})}function c(a){var b='<div class="themeSectionMediaItem idSectionMediaItem-image" data-content="'+a+'" data-type="image" data-width="" data-height="" data-poster="" data-caption="" data-url="'+a+'" data-attribution="" style="background-image:url('+a+');"></div>';return b}function d(a,b){var c='<video poster="'+b+'" height="200" controls><source src="'+a+'.webm" type="video/webm"></source><source src="'+a+'.mp4" type="video/mp4"></source></video>';return c}function e(a){var b='<audio><source src="'+a+'" type="audio/mp3"></source></audio>';return b}b.prototype.addMarker=function(a,b,c,d,e,f){function g(a,b,c){var e=new H.map.DomIcon('<div class="mapHotSpotTheme mapPPins mapHotSpotOrange" id="mp'+d+'"></div>'),f=new H.map.DomMarker(b,{icon:e});f.setData(c),a.addObject(f)}var h=new H.map.Group;this.map.addObject(h);var i=(this.map,this.ui);h.addEventListener("tap",function(a){var b=new H.ui.InfoBubble(a.target.getPosition(),{content:a.target.getData()});$(document).click(function(a){$(a.target).is("#mp"+d)||i.removeBubble(b)}),i.addBubble(b)},!1);var j='<a href="'+c+'" ><img src="//cyarkpublicdata.blob.core.windows.net/projects/'+d+"/public_front/"+d+'_hero_image_h230_w360.jpg"><div class="tileBar"><div class="tileInfo"><div class="tileCountry">'+e+'</div><div class="tileName">'+f+'</div><div class="tileDesc"></div></div></div></a>';g(h,{lat:a,lng:b},j)},b.prototype.addGeoLines=function(a,b,f,g,h,i,j,k,l,m,n,o,p){function q(a,b,f,g,h){function i(){k>=$("#timerangestart").val()&&k<=$("#timerangeend").val()||l>=$("#timerangestart").val()&&l<=$("#timerangeend").val()||k<$("#timerangestart").val()&&l>$("#timerangeend").val()?r.addObject(a):r.removeObject(a)}a.getProvider().addEventListener("tap",function(a){if(a.target.id===g){var i="";if(h.length>0)switch(p[0].type){case"image":i=c(h[0].content);break;case"video":i=d(h[0].content,h[0].poster);break;case"audio":i=c(h[0].poster),i+=e(h[0].content)}var j=new H.ui.InfoBubble(r.screenToGeo(a.currentPointer.viewportX,a.currentPointer.viewportY),{content:'<div class="mapHotspotNonProject" id="line'+g+'"><h3>'+b+"</h3><p>"+f+"</p>"+i+"</div>"}),k=!1;$(document).click(function(a){!$(a.target).is("line"+g)&&k&&s.removeBubble(j),k=!0}),s.addBubble(j)}}),$("#onoffswitchNL"+o).click(function(){$("#onoffswitchNL"+o).is(":checked")?r.addObject(a):r.removeObject(a)}),$("#timerangestart").change(function(){i()}),$("#timerangeend").change(function(){i()})}var r=this.map,s=this.ui,t=f.split(";"),u=GeodesicPolyline({points:t,style:{strokeColor:n,lineWidth:5},arrows:{color:"#FFFFFF",width:2,length:3,frequency:4}});u.id=a,r.addObject(u),q(u,g,h,a,p)},b.prototype.addLayer=function(a,b,c,d,e){function f(){d>=$("#timerangestart").val()&&d<=$("#timerangeend").val()||e>=$("#timerangestart").val()&&e<=$("#timerangeend").val()||d<$("#timerangestart").val()&&e>$("#timerangeend").val()?i.addLayer(h):i.removeLayer(h)}var g=new H.data.kml.Reader("//cyarkpublicdata.blob.core.windows.net/"+a);g.parse();var h=g.getLayer();h.id="layer"+c,this.map.addLayer(h);var i=this.map,j=this.ui;h.getProvider().addEventListener("tap",function(a){var b=a.target.getData().description;(null===a.target.getData().description||"undefined"===a.target.getData().description)&&(b="");var d=new H.ui.InfoBubble(i.screenToGeo(a.currentPointer.viewportX,a.currentPointer.viewportY),{content:'<div class="mapHotspotNonProject" id="layer'+c+'"><h3>'+a.target.getData().name+"</h3><p>"+b+"</p></div>"}),e=!1;$(document).click(function(a){!$(a.target).is("layer"+c)&&e&&j.removeBubble(d),e=!0}),j.addBubble(d)}),$("#onoffswitch"+c).click(function(){$("#onoffswitch"+c).is(":checked")?i.addLayer(h):i.removeLayer(h)}),$("#timerangestart").change(function(){f()}),$("#timerangeend").change(function(){f()})};var f=1;b.prototype.addNonProjectPins=function(b,g,h,i,j,k,l,m,n,o,p,q,r){function s(a,c,d){for(var e=new H.map.DomIcon('<div class="mapHotSpotTheme mapHotSpotOrangeSM" id="mp'+b+'"></div>'),g=0;g<r.length;g++)n===r[g].id&&(e=new H.map.DomIcon('<div class="mapHotSpotTheme mapNPPins mapHotSpotNP'+r[g].id+'" style="'+r[g].icon+'" id="mp'+b+'"></div>'));var h=new H.map.DomMarker(c,{icon:e,zIndex:f});h.setData(d),a.addObject(h),f++}var t=new H.map.Group({zIndex:f});this.map.addObject(t);var u=(this.map,this.ui);t.addEventListener("tap",function(c){var d=new H.ui.InfoBubble(c.target.getPosition(),{content:c.target.getData()});$(document).click(function(a){$(a.target).is("#mp"+b)||$(a.target).parents("div#mp"+b).length||$(a.target).is(".mpPopup")||$(a.target).parents(".mpPopup").length||u.removeBubble(d)}),u.addBubble(d);var e=new a.controls.MediaPopup($(".mpPopup"));$(".themeSectionMediaItem").click(function(){console.log("media click");var a=$(this).data("type");if("quote"!==a&&a){var b=$(this).parent(),c=$(this).index(),d=[];b.find(".themeSectionMediaItem").each(function(){var a=$(this);d.push({type:a.data("type"),content:a.data("content"),width:a.data("width"),height:a.data("height"),poster:a.data("poster"),caption:a.data("caption"),attribution:a.data("attribution"),url:a.data("url")})}),console.log(d),e.show(d,c)}})},!1);var v="";if(q.length>0)switch(q[0].type){case"image":v=c(q[0].content);break;case"video":v=d(q[0].content,q[0].poster);break;case"audio":v=c(q[0].poster),v+=e(q[0].content)}var w='<div class="mapHotspotNonProject" id="mp'+b+'"><h3>'+j+"</h3><p>"+k+"</p><center>"+v+"</center></div>";s(t,{lat:h,lng:i},w)},b.prototype.addDataPins=function(b,c){function d(a,d){h=[],_.each(b,function(b){if(b.time_range_start>=a&&b.time_range_start<=d||b.time_range_end>=a&&b.time_range_end<=d||a<b.time_range_start&&d>b.time_range_end){null===b.value&&(b.value=0);var c=b.value/1e3;1>c&&(c=1.1),h.push(new H.clustering.DataPoint(b.latitude,b.longitude,c,[b.region,b.time_range_start,b.time_range_end,b.value]))}});var i='<svg xmlns="http://www.w3.org/2000/svg" height="20px" width="20px"><circle cx="10px" cy="10px" r="10px" fill="'+c.fill_color+'" style="opacity:0.5;" /></svg>',j=(new H.map.Icon(i,{size:{w:20,h:20},anchor:{x:10,y:10}}),'<svg xmlns="http://www.w3.org/2000/svg" height="{diameter}" width="{diameter}"><circle cx="{radius}px" cy="{radius}px" r="{radius}px" fill="'+c.fill_color+'" style="opacity:0.5;" class="themeDataPin" /></svg>'),k=new H.clustering.Provider(h,{minPts:1,theme:{getClusterPresentation:function(a){var b=a.getWeight(),c=.015*b;10>c&&(c=10);var d=2*c,e=j.replace(/\{radius\}/g,c).replace(/\{diameter\}/g,d),f=new H.map.Icon(e,{size:{w:d,h:d},anchor:{x:c,y:c}}),g=new H.map.Marker(a.getPosition(),{icon:f,min:a.getMinZoom(),max:a.getMaxZoom()});return g.setData(a),g},getNoisePresentation:function(){}}});k.addEventListener("tap",function(a){function b(a,b,c){$('<div id="tooltip">'+c+"</div>").css({top:b-16,left:a+20}).appendTo("body").fadeIn()}var d=[],e=[],h=[],i="";a.target.getData().forEachDataPoint(function(a){e[a.getData()[1]]?e[a.getData()[1]]+=a.getData()[3]:e[a.getData()[1]]=a.getData()[3],-1===h.indexOf(a.getData()[0])&&h.push(a.getData()[0])}),_.each(h,function(a){i+=a+" "});var j=0;for(var k in e)d.push([parseInt(k),parseInt(e[k])]),j+=parseInt(e[k]);var l=new H.ui.InfoBubble(f.screenToGeo(a.currentPointer.viewportX,a.currentPointer.viewportY),{content:'<div class="mapHotspotDataCircle" id="dataCircle"><div class="graph-container" id="graphcont"><h3>'+i+'<div id="graphTotal">Total number of People: '+j.toString().replace(/\B(?=(?:\d{3})+(?!\d))/g,",")+'</div></h3><div id="graph-lines"></div></div></div>'}),m=[{data:d,color:"#3F9ECF",points:{radius:3,fillColor:"#3F9ECF"}}],n=!1;$(document).click(function(a){$(a.target).is("#dataCircle")||!n||$(a.target).parents("#dataCircle").length||g.removeBubble(l),n=!0}),$("#dataCircle").html(""),g.addBubble(l),$.plot($("#graph-lines"),m,{series:{points:{show:!0,radius:5},lines:{show:!0},shadowSize:0},grid:{color:"#646464",borderColor:"transparent",borderWidth:20,hoverable:!0},xaxis:{tickColor:"transparent",axisLabel:c.graph_x_label,axisLabelUseCanvas:!0,axisLabelColour:"#646464",axisLabelPadding:5},yaxis:{axisLabel:c.graph_y_label,tickFormatter:function(a){return a.toString().replace(/\B(?=(?:\d{3})+(?!\d))/g,",")},axisLabelUseCanvas:!0,axisLabelColour:"#646464",axisLabelPadding:5}});var o=null;$("#graph-lines, #graph-bars").bind("plothover",function(a,d,e){if(e){if(o!==e.dataIndex){o=e.dataIndex,$("#tooltip").remove();var f=e.datapoint[0],g=e.datapoint[1];b(e.pageX,e.pageY,g.toString().replace(/\B(?=(?:\d{3})+(?!\d))/g,",")+" "+c.graph_point_label+" between "+f+"CE and "+(parseInt(f)+4)+"CE")}}else $("#tooltip").remove(),o=null})}),e=new H.map.layer.ObjectLayer(k),f.addLayer(e)}var e,f=this.map,g=this.ui,h=[];d(a.data.time_range_start,a.data.time_range_end),$("#timerangestart").change(function(){f.removeLayer(e),d($("#timerangestart").val(),$("#timerangeend").val())})},b.prototype.addInfoMarker=function(a,b,c,d,e,f,g){function h(a,b,c){var e=new H.map.DomIcon('<div class="mapHotSpotTheme mapPPins mapHotSpotOrangeSM" id="mp'+d+'"></div>'),f=new H.map.DomMarker(b,{icon:e});f.setZIndex(1e3),f.setData(c),a.addObject(f),a.setZIndex(1e3)}var i=new H.map.Group;this.map.addObject(i);var j=(this.map,this.ui);i.addEventListener("tap",function(a){var b=new H.ui.InfoBubble(a.target.getPosition(),{content:a.target.getData()});$(document).click(function(a){$(a.target).is("#mp"+d)||j.removeBubble(b)}),j.addBubble(b)},!1);var k='<a href="'+c+'" ><img src="//cyarkpublicdata.blob.core.windows.net/projects/'+d+"/public_front/"+d+'_hero_image_h230_w360.jpg"><div class="tileBar"><div class="tileInfo"><div class="tileCountry">'+e+'</div><div class="tileName">'+f+'</div><div class="tileDesc"><span class="tileTime">'+g[0]+"-"+g[1]+"</span></div></div></div></a>";h(i,{lat:a,lng:b},k)},a.controls.SatelliteMap=b}(),function(){function b(b,d){PxFacetSearch.View.call(this,b),this.sorter=new a.controls.ThemeSearchSorter,this.map=d,this.currentView="map",this.pageSize=Number.MAX_VALUE,this.visibleCount=this.pageSize,this.query.onUpdate(c.bind(this)),this.render()}function c(){$("html,body").scrollTop(0),this.visibleCount=this.pageSize,this.render()}var d={grid:"grid",map:"map"};b.prototype=Object.create(PxFacetSearch.View.prototype),b.prototype.constructor=b,b.prototype.resize=function(){this.currentView===d.grid&&(this.grid.resize(),this.grid.redraw(!0))},b.prototype.setViewType=function(a){a!==this.currentView&&(this.currentView=a,this.render())},b.prototype.createCheckboxClickHandler=function(){},b.prototype.render=function(){var b=this.sortedMatchIds,c=Math.min(b.length,this.visibleCount),d=b.slice(0,c);$(".mapHotSpotTheme").hide();for(var e=0;e<d.length;e++)$("#mp"+a.table.getValue("id",d[e])).show();if(b.length>=1)for($(".theme").hide(),e=0;e<d.length;e++)$("#theme-"+a.table.getValue("themeprettyname",d[e])).show();else $(".theme").show()},a.controls.ThemeBrowseView=b}(),function(){function b(a,b){this.query="",this.filterName=b,this.searchResults={},this.themeIdIndices=null;var c=_.debounce(_.bind(this.startSearch,this),300);this.$el=a.on("change keyup input",_.bind(function(a){13===a.keyCode?this.startSearch():c()},this)),""!==this.$el.val()&&this.startSearch()}function c(){this.searchMatchIds=null}function d(a,b){this.searchResults=b,PxFacetSearch.Filter.call(this,a)}b.prototype.startSearch=function(){this.query=this.$el.val(),!this.query||this.searchResults[this.query]?this.updateView(this.query):$.ajax({dataType:"json",url:"/api/themes/search?q="+encodeURIComponent(this.query),success:this.createResultsHandler(this.query)})},b.prototype.ensureThemeIdLookup=function(){if(!this.themeIdIndices){this.themeIdIndices={};var b,c,d=a.table.getColumn("themeid").values;for(b=0,c=d.length;c>b;b++)this.themeIdIndices[d[b]]=b}},b.prototype.updateView=function(b){var c=b?this.searchResults[b]:null;a.view.sorter.searchMatchIds=c,a.view.query.select(this.filterName,b)},b.prototype.createResultsHandler=function(a){return $.proxy(function(b){this.ensureThemeIdLookup();var c,d,e,f=[];for(c=0,d=b.length;d>c;c++)e=this.themeIdIndices[b[c]],e>=0&&f.push(e);this.searchResults[a]=f,this.query===a&&this.updateView(a)},this)},c.prototype.sortIds=function(a){if(!this.searchMatchIds)return a;var b=a.slice();return b.sort($.proxy(this.compareIdsBySearchResultIndex,this)),b},c.prototype.compareIdsBySearchResultIndex=function(a,b){if(!this.searchMatchIds)return 0;var c=this.searchMatchIds.indexOf(a),d=this.searchMatchIds.indexOf(b);return d>c?-1:c>d?1:0},d.prototype=Object.create(PxFacetSearch.Filter.prototype),d.prototype.constructor=d,d.prototype.select=function(a){var b,c,d,e,f=a?this.searchResults[a]||[]:[],g=[],h=[];for(b=0,c=this.matches.length;c>b;b++)d=this.matches[b],e=f.indexOf(b)>=0||!a,d!==e&&(d?g.push(b):h.push(b));return this.updateSelections(h,g)},a.controls.ThemeSearchBox=b,a.controls.ThemeSearchFilter=d,a.controls.ThemeSearchSorter=c}(),function(){function b(){c=a.data.time_range_start||-1060,d=a.data.time_range_end||2020,this.$el=$("#timelineCanvasHost"),this.$labels=$("#timelineLabels"),this.bgCanvas=document.getElementById("timelineCanvas"),this.bgCtx=this.bgCanvas.getContext("2d"),this.buckets=[],this.dirty=!0,this.currentMin=c,this.currentMax=d,$("#timeRangeSlider").slider({range:!0,min:c,max:d,step:e,values:[this.currentMin,this.currentMax],slide:$.proxy(function(a,b){this.currentMin=b.values[0],this.currentMax=b.values[1],this.dirty=!0},this),change:$.proxy(function(){a.view.query.select("timeRange",{min:this.currentMin,max:this.currentMax,includeNulls:!0}),$("#timerangestart").val(this.currentMin),$("#timerangeend").val(this.currentMax),$("#timerangestart").trigger("change"),$("#timerangeend").trigger("change")},this)}),this.resize();var b=$.proxy(function(){this.redraw(),window.requestAnimationFrame(b)},this);b()}var c=-1060,d=2020,e=10,f="#3F9ECF",g="#474C53",h=2,i=1,j=100,k=[.05,.1,.2,.3,.2,.1,.05];b.prototype.resize=function(){if(Modernizr.canvas){var a=this.$el.width(),b=Math.floor(a/(h+i));this.bucketize(b),this.smoothBuckets(),this.maxHeight=this.$el.height(),this.bgCanvas.width=this.buckets.length*(h+i),this.bgCanvas.height=this.maxHeight,this.drawLabels(),this.dirty=!0}},b.prototype.smoothBuckets=function(){var a,b,c,d,e=[],f=k.length,g=Math.floor(f/2),h=this.buckets.length;for(a=0;h>a;a++){for(d=0,b=0;f>b;b++)c=Math.max(0,Math.min(h-1,a-g+b)),d+=this.buckets[c]*k[b];e[a]=d}this.buckets=e},b.prototype.bucketize=function(b){var e,f,g,h,i,j,k=a.table.getColumn("timeRange"),l=k.values,m=[],n=(d-c)/b;for(PxFacetSearch.initArray(m,b,0),e=0,f=l.length;f>e;e++)if(g=l[e],g&&2===g.length&&(i=g[0],j=g[1],0!==i||0!==j))for(h=Math.floor((i-c)/n);b>h&&!(c+(h+1)*n>j);h++)m[h]++;this.buckets=m},b.prototype.redraw=function(){if(this.dirty&&Modernizr.canvas){var a,b,e,j,k,l,m=this.bgCanvas,n=this.bgCtx,o=0,p=(d-c)/this.buckets.length;for(e=0,j=this.buckets.length;j>e;e++)o=Math.max(o,this.buckets[e]);for(n.setTransform(1,0,0,1,0,0),n.lineWidth=h,n.strokeStyle=f,n.clearRect(0,0,m.width,m.height),n.beginPath(),e=0,j=this.buckets.length;j>e;e++)a=c+e*p,b=a<this.currentMin||a>this.currentMax?g:f,n.strokeStyle!==b&&(n.stroke(),n.strokeStyle=b,n.beginPath()),k=e*(h+i),l=Math.round(this.maxHeight*(1-this.buckets[e]/o)),n.moveTo(k,this.maxHeight),n.lineTo(k,l);n.stroke(),this.dirty=!1}},b.prototype.drawLabels=function(){this.$labels.empty();var a=Math.floor(this.bgCanvas.width/j),b=d-c,e=b;Math.floor(b/10)<a?e=10:Math.floor(b/25)<a?e=25:Math.floor(b/50)<a?e=50:Math.floor(b/100)<a?e=100:Math.floor(b/200)<a?e=200:Math.floor(b/250)<a?e=250:Math.floor(b/500)<a?e=500:Math.floor(b/1e3)<a?e=1e3:Math.floor(b/2e3)<a?e=2e3:Math.floor(b/3e3)<a&&(e=3e3);for(var f=c-c%e,g="",h=0;d-e>f;)g=0>f?"BCE":"CE",h=100*(1+(f-d)/b),$('<div class="timelineLabel" style="left: '+h+'%;"/>').append($('<div class="timelineText"/>').text(Math.abs(f)+" "+g)).appendTo(this.$labels),f+=e},a.controls.Timeline=b}(),function(){var b=.3,c=1200,d={left:520,top:90};CyArk.pages.about=function(){var e=document.getElementById("aboutCanvas"),f=e.getContext("2d"),g=$(e),h=$(window),i=$(document),j=$("#topNav").height(),k=new PxLoader,l=[],m={x:0,y:0},n=function(a,b){var c=k.addImage(b),d=isNaN(a)?$(a).position().top:parseInt(a,10);return l.push({image:c,scrollPoint:d}),c},o=k.addImage("/images/aboutShadow_opt.png"),p=(n(0,"/images/aboutPhotoReal_opt.png"),n($("#aboutBlockPoints"),"/images/aboutPointCloud_opt.png"));n($("#aboutBlockWire"),"/images/aboutWireframe_opt.png"),n($("#aboutBlockReal"),"/images/aboutPhotoReal_opt.png"),k.addCompletionListener(function(){e.width=p.width,e.height=p.width,q()}),k.start();var q=function(){g.height(g.width());var a=h.height()-j,b=p.width/p.height,c=g.width()/b,d=a-c,e=g.width()/p.width,f=(g.height()-c)*(1/e),i=Math.min(100,.15*g.height());i>d&&(f+=(i-d)*(1/e)),m.y=f,s()},r=function(a,b,c){f.drawImage(a,b+m.x,c+m.y)},s=function(){for(var k,m,n,q,s,t=Math.max(0,h.scrollTop()+.1*h.height()),u=(i.height()-h.height(),0);u<l.length;u++)l[u].scrollPoint<t&&(k=l[u],q=u,u+1<l.length?(m=l[u+1],s=u+1):(m=null,s=null));if(k){var v=(h.height()-j,g.width()/(p.width/p.height),300),w=800,x=.15+.85*((a.utils.clamp(t,v,w)-v)/(w-v));if(g.css("opacity",x),g.show(),f.clearRect(0,0,e.width,e.height),f.save(),f.globalCompositeOperation="source-over",m){var y=m.scrollPoint,z=y-c;if(n=a.utils.clamp((t-z)/(y-z),0,1)){r(k.image,0,0);var A=f.createLinearGradient(-1*e.width*b,0,e.width+e.width*b,1e3);A.addColorStop(a.utils.clamp(n-b/2,0,1),"rgba(0,0,0,0)"),A.addColorStop(a.utils.clamp(n+b/2,0,1),"rgba(0,0,0,1)"),f.globalCompositeOperation="destination-in",f.rect(0,0,e.width,e.height),f.fillStyle=A,f.fill(),f.globalCompositeOperation="destination-over",r(m.image,0,0)}else r(k.image,0,0);f.globalCompositeOperation="destination-over",r(o,d.left,d.top),f.restore()}else{var B=1-a.utils.clamp((t-k.scrollPoint)/c,0,1);B>0?(f.save(),f.globalAlpha=B,r(o,d.left,d.top),r(k.image,0,0),f.restore()):g.hide()}}};h.resize(q),h.scroll(function(){s()}),$("#aboutScroll").delay(1e3).animate({opacity:1,top:0},500,"easeInOutCubic")}}(),function(){CyArk.pages.aboutPages=function(){function a(){var a=$(".clampText");a.each(function(a,b){var c="  [ ... ]",d=$(b),e=d.clone().addClass("clampTextExpand"),f=$clamp(b,{clamp:$(b).data("linecount")||3,useNativeClamp:!1,truncationChar:c}),g="undefined"!=typeof f.clamped;g&&$(b).html($(b).html().replace(c,' <span class="clampTextMore">more</span>')).after(e),setTimeout(function(){d.delay(500).css("opacity",1)},100)}),$(".clampTextMore").click(function(){$(this).parent().siblings(".clampTextExpand").show(),$(this).parent().hide()})}a()}}(),function(){CyArk.pages.aboutPartners=function(){function a(){function a(a){b.removeClass("activeFilter").filter(a).addClass("activeFilter"),c.hide().filter("."+a.data("filter")).show()}var b=$(".partnersFilter"),c=$(".partnersTile");b.click(function(){a($(this))}),a(b.filter(".activeFilter"))}a()}}(),function(){CyArk.pages.home=function(a){$(window).resize(function(){c(),b()}),c(),b(),m(0,!0),$(".homeFooterNewsSelector").click(function(){var a=$(this).index();m(a)});var d=setInterval(function(){var a=(j+1)%g;k(a)},1e3*(a||30));$(".homeSliderSelector").click(function(){var a=$(this).index();k(a),d&&(clearInterval(d),d=0)})};var b=function(){var a=0;$(".homeSliderContentItem").each(function(){var b=$(this).outerHeight(!0);a=b>a?b:a}),a=Math.min(a,$(window).innerHeight()-$("#topNav").height()),$("#homeSliderContentItems").height(a).fadeTo(500,1)},c=function(){var b=a.utils.getElementRect($(".homeSliderBackgroundItem")),c={x:0,y:0,width:1280,height:720},d=a.utils.cover(b,c);$(".homeSliderBackgroundVideo").css({top:d.y,left:d.x,width:d.width,height:d.height})},d=$(".homeSliderBackgroundItem"),e=$(".homeFooterNewsItem"),f=$(".homeSliderContentItem"),g=f.length,h=!1,i=-1,j=-1,k=function(a){if(h)return void(i=a);if(a!==j){$(".homeSliderSelector").removeClass("selected").eq(a).addClass("selected");var b=d.eq(j),c=d.eq(a),e=f.eq(j),g=f.eq(a),l=800,m="easeOutQuart";h=!0,b.stop(!0).transition({scale:"1.1",opacity:0},l,m,function(){b.removeClass("selected"),e.removeClass("deselected"),h=!1,-1!==i&&(k(i),i=-1)}),f.removeClass("selected"),e.addClass("deselected"),g.addClass("selected"),c.stop(!0).css({scale:"1"}).addClass("selected").transition({opacity:1,scale:1.025},l,m),j=a}};k(0);var l=-1,m=function(a,b){if(l!==a){var c=e.eq(l),d=e.eq(a),f=b?0:400,g="easeInOutQuart";c&&d&&(c.removeClass("selected").animate({left:"30px",opacity:0},f,g),d.css("left","-30px").addClass("selected").animate({left:"0px",opacity:1},f,g)),$(".homeFooterNewsSelector").removeClass("selected"),$(".homeFooterNewsSelector").eq(a).addClass("selected"),l=a}}}(),function(){function a(){var a=$("#siteData").val();$.ajax({type:"POST",url:"/api/projects/3d-editor/save",data:{siteData:a},dataType:"json",success:b})}function b(a){var b="/projects/3d-editor/detail/"+a+"?editmode=1",c=$('<iframe id="frame3d">').attr("src",b);$("#frame3dContainer").empty().append(c)}function c(a){var b;a.source;try{b=JSON.parse(a.data)||{}}catch(c){return}var f=b.data;switch(b.type){case"cyark.updateHotspots":e(f);break;case"cyark.modelLoadTime":d(f)}}function d(a){var b=(a/1e3).toFixed(1);$("#viewerLoadTime").text("Load: "+b+" secs").show()}function e(a){var b=window.$("#siteData"),c=JSON.parse(b.val());c.hotspots=a,b.val(JSON.stringify(c,4,4))}CyArk.pages.project3dEditor=function(){$("#refreshButton").click(a),window.addEventListener("message",c,!1)}}(),function(){function b(b){switch($(".viewSelectorOption").removeClass("selected"),$("#"+b+"ViewOption").addClass("selected"),a.view.setViewType(b),b){case"grid":$("#grid").fadeIn(),$("#map").fadeOut();break;case"map":$("#grid").fadeOut(),$("#map").fadeIn()}}function c(a){var b,c,d,e=[];for(b=0,c=a.length;c>b;b++)d=a[b],"string"===jQuery.type(d)&&(d=jQuery.trim(d)),(d||0===d||d===!1)&&e.push(d);return 0===e.length?null:1===e.length?e[0]:e}function d(a){var b,d,e,f=[];for(b=0,d=a.length;d>b;b++)e=a[b],e&&e.indexOf(",")>=0&&(e=c(e.split(","))),f.push(e);return f}CyArk.pages.projectBrowse=function(){var c=a.table=new PxFacetSearch.Table,e=a.data.projectBrowse;c.addColumn(new PxFacetSearch.Column("id",e.ids)),c.addColumn(new PxFacetSearch.Column("prettyId",e.prettyIds)),c.addColumn(new PxFacetSearch.Column("projectName",e.projectNames)),c.addColumn(new PxFacetSearch.Column("latitude",e.latitudes)),c.addColumn(new PxFacetSearch.Column("longitude",e.longitudes)),c.addColumn(new PxFacetSearch.Column("shortDescription",e.shortDescriptions)),c.addColumn(new PxFacetSearch.Column("image",e.images)),c.addColumn(new PxFacetSearch.CategoryColumn("country",e.countries)),c.addColumn(new PxFacetSearch.CategoryColumn("culture",d(e.cultures))),c.addColumn(new PxFacetSearch.CategoryColumn("cyark500",e.cyark500)),c.addColumn(new PxFacetSearch.CategoryColumn("chapterCounts",e.chapterCounts)),c.addColumn(new PxFacetSearch.CategoryColumn("theme",e.themes)),c.addColumn(new PxFacetSearch.RangeColumn("timeRange",e.timeRanges)),a.view=new a.controls.ProjectBrowseView(c),$("#gridViewOption").data("view","grid"),$("#mapViewOption").data("view","map"),$(".viewSelectorOption").click(function(){var a=$(this).data("view");b(a)});var f="search",g=$("#projectSearch"),h=new a.controls.ProjectSearchBox(g,f),i=new a.controls.ProjectSearchFilter(f,h.searchResults);$("#filtersReset").on("click",function(){g.val("").trigger("change")}),a.view.query.addFilter(i),a.timeline=new a.controls.Timeline,b("grid"),$(window).resize(a.utils.debounce(function(){a.view.resize(),a.timeline.resize()},200))}}(),function(){CyArk.pages.projectInDepth=function(){var b=$("#idBackground"),c=($(".idBackgroundImage"),$(window));c.scroll(function(){var d=a.utils.clamp(c.scrollTop(),0,800),e=Math.round(d/-2);b.css("y",e)});var d=new a.controls.MediaPopup($(".mpPopup"));$(".idSectionMediaItem").click(function(){var a=$(this).data("type");if("quote"!==a&&a){var b=$(this).parent(),c=$(this).index(),e=[];b.find(".idSectionMediaItem").each(function(){var a=$(this);e.push({type:a.data("type"),content:a.data("content"),width:a.data("width"),height:a.data("height"),poster:a.data("poster"),caption:a.data("caption"),attribution:a.data("attribution"),url:a.data("url")})}),d.show(e,c)}})}}(),function(){function b(){z(),$(".nano").nanoScroller()}function c(){var a=$(".clampText");a.each(function(a,b){var c="  [ ... ]",d=$(b),e=d.clone().addClass("clampTextExpand"),f=$clamp(b,{clamp:$(b).data("linecount")||5,useNativeClamp:!1,truncationChar:c}),g="undefined"!=typeof f.clamped;g&&$(b).html($(b).html().replace(c,' <span class="clampTextMore">...</span>')).after(e),setTimeout(function(){d.delay(500).css("opacity",1)
},100)}),$(".clampTextMore").click(function(){$(this).parent().siblings(".clampTextExpand").show(),$(this).parent().hide(),b()}),b()}function d(){$(".nano").nanoScroller(),$(".infoBoxContent").fadeTo(0,500)}var e,f=3,g=null,h=[],i=!0,j=!1,k=null,l=$("#project2dViewer"),m=$("#project2dHotspots");CyArk.pages.projectIntro=function(f){g=f,i=a.use3d&&f.modelData,i?n():f.panoData?s():f.imageData?r():f.fallback2dUrl?window.location=f.fallback2dUrl:j=!0,j&&$(".navInfo").hide(),h.length>0&&$(".projectGuideButton").show(),$(".nano").nanoScroller({flashDelay:1e3,preventPageScrolling:!0}),$(".projectGuideButton").click(x),$("#projectInfoButton").click(w),$(".navInfo").click(w),$(".infoBoxClose").click(function(){w(!1)}),setTimeout(function(){c(),d(),y($("#projectInfoButton")),y($(".projectModelDescription .clampTextMore")),b(),w(!0)},50),a.utils.getQueryStringParameterByName("docked")&&$("#projectBody").addClass("infoBoxDocked"),a.utils.getQueryStringParameterByName("showinfo")&&(e=!0),$(window).resize(b)};var n=function(){var a=g.modelData;CyArk.pages.initViewer(a,{hotspotSelected:v,suppressLoadingMessage:!0,loadingProgress:p,loadingComplete:q}),h=_.pluck(a.hotspots,"media")},o=!1,p=function(){$("#viewer3d").fadeTo(0,.25),o||(o=!0,$("#projectIntroLoader").show())},q=function(){$(".projectHideOnLoad").delay(500).transition({opacity:1},500),$("#viewer3d").delay(100).fadeTo(500,1),$("#projectIntroLoader").delay(100).fadeOut(),e&&setTimeout(function(){w()},500),a.utils.getQueryStringParameterByName("resetHelpCount")&&a.settings.set("helpCount",0);var b=a.utils.supportsTouch(),c=a.settings.getIntOrDefault("helpCount",0);f>c&&(a.settings.set("helpCount",c+1),b&&$("#projectHelp").addClass("supportsTouch"),setTimeout(function(){$("#projectHelpDrag").addClass("showHelp")},1e3),setTimeout(function(){$("#projectHelpDrag").removeClass("showHelp"),b||$("#projectHelpZoom").addClass("showHelp")},4e3),setTimeout(function(){$("#projectHelpZoom").removeClass("showHelp")},6e3))},r=function(){$("#projectIntro").addClass("no3d");var b=g.imageData;h=_.pluck(b.hotspots,"media");var c=$("<img>").addClass("projectMainImage").addClass("projectMainImageSized").on("load",function(){k={x:0,y:0,width:this.width,height:this.height},t(),c.fadeIn(1e3)}).attr("src",a.paths.project+b.mainImage).appendTo(l);$(window).resize(t)},s=function(){$("#projectIntro").addClass("no3d");var b=g.panoData;h=_.pluck(b.hotspots,"media"),a.paths.project,$(window).resize(t)},t=function(){if(k){var b=a.utils.getElementRect(l),c=a.utils.cover(b,k),d=c.width/k.width;$(".projectMainImageSized").css({top:c.y,left:c.x,width:c.width,height:c.height}),_.each(g.imageData.hotspots,function(a,b){var c=$("#hotspot-"+b);0===c.length&&(c=$('<div class="hotspot-icon">').attr("id","hotspot-"+b).addClass("hotspot-"+a.type).on("click",function(){u.show([a.media],0)}).appendTo(m));var e=a.position;c.css({left:e.x*d,top:e.y*d})})}},u=new a.controls.MediaPopup($(".mpPopup")),v=function(a){var b=[a.hotspotInfo.media];u.show(b,0)},w=function(a,b){var c=$(".infoBoxContainer").hasClass("show");b&&($(".infoBoxContainer").addClass("noanimation"),setTimeout(function(){$(".infoBoxContainer").removeClass("noanimation")},1e3)),"undefined"==typeof a&&(a=!c),$(".infoBoxContainer").toggleClass("show",a),a===!1&&($(".navInfo").addClass("highlight"),setTimeout(function(){$(".navInfo").removeClass("highlight")},400)),$(".nano").nanoScroller(),$("#projectBody").toggleClass("infoOpen",a),$("#projectBody").toggleClass("infoClosed",!a)},x=function(){u.show(h,0)},y=function(a){if(a&&a.length){var b=$('<div class="proxyElement"></div>').css("cursor",a.css("cursor")).data("proxyTo",a).appendTo("#proxyElements");b.on({click:function(){var a=b.data("proxyTo");a.trigger("click")},mouseenter:function(){var a=b.data("proxyTo");a.addClass("hover")},mouseleave:function(){var a=b.data("proxyTo");a.removeClass("hover")}}),z()}},z=function(){var a=$("#proxyElements").offset();$(".proxyElement").each(function(b,c){var d=$(c).data("proxyTo"),e=d.offset();$(c).css({left:e.left-a.left,top:e.top-a.top,width:d.outerWidth(),height:d.outerHeight()})})}}(),function(){CyArk.pages.projectMap=function(b,c,d,e,f,g){var h=new a.controls.SatelliteMap(b,c,d);h.addMarker(b,c,"",e,f,g)}}(),function(){CyArk.pages.shared=function(){$("#share").click(function(){return c(),!1}),$("#shareOverlay").click(function(){return c(!1),!1})},a.controls.initSocial();var b=!1,c=function(a){a="undefined"==typeof a?a=!b:a,$("#share").toggleClass("open",a),a?($("#shareOverlay").show(),$("#sharePopup").css({opacity:0,y:20,display:"block"}).toggleClass("open",a).transition({opacity:1,y:0},250,"easeOutQuart")):($("#shareOverlay").hide(),$("#sharePopup").toggleClass("open",a).fadeTo(0,300).hide()),b=a};$("#topNavMenuToggle, #topNavMenuOverlay").click(function(){$("body").toggleClass("mobileNavMenuOpen")});var d=$(".subNav h2").text();if($("#topNavSubNavHeader").text(d),a.utils.getQueryStringParameterByName("no3d")&&(a.use3d=!1),a.utils.getQueryStringParameterByName("debug")){$("body").toggleClass("debug",!0);for(var e=$('<div id="resInd"></div>').appendTo("body"),f=0;5>f;f++)e.append('<div class="resDot"></div>')}if(!CyArk.disableIEFlyout){var g=a.utils.getQueryStringParameterByName("ielogo");switch(1===CyArk.variation&&(g="footer"),g){case"rethink":$("body").removeClass("ieFooter").addClass("ieRethink"),window.ieFlyout.init();break;default:case"footer":$("body").removeClass("ieRethink").addClass("ieFooter")}}}(),function(){CyArk.pages.storyList=function(){var b=a.table=new PxFacetSearch.Table,c=a.data.newsBrowse;b.addColumn(new PxFacetSearch.Column("news_ID",c.ids)),b.addColumn(new PxFacetSearch.Column("news_ID_pretty",c.pids)),b.addColumn(new PxFacetSearch.Column("headline",c.headlines)),b.addColumn(new PxFacetSearch.Column("subheadline",c.subheadlines)),b.addColumn(new PxFacetSearch.Column("author",c.authors)),b.addColumn(new PxFacetSearch.Column("description",c.descriptions)),a.view=new a.controls.NewsBrowseView(b);var d="search",e=$("#newsSearch"),f=new a.controls.NewsSearchBox(e,d),g=new a.controls.NewsSearchFilter(d,f.searchResults);$("#filtersReset").on("click",function(){e.val("").trigger("change")}),a.view.query.addFilter(g)}}(),function(){function a(){}function b(){var a=d.combineTextures(),b=$("#buttonContainer");b.append($("<br/>")),_.each(a,function(a){var c=$("<a/>",{text:a.diffuse,download:a.fileName,href:a.dataUrl});b.append(c),b.append($("<br/>"))})}function c(){$(".getTexturesButton").on({click:b})}var d=null;CyArk.pages.textureCombiner=function(b){console.log(b);var e=new CyArk.Viewer;d=e,e.init({container:document.getElementById("container3d")}),e.showSite(b.modelData,a,c),e.render()}}(),function(){var b=0,c=0;CyArk.pages.themeList=function(){var g=a.table=new PxFacetSearch.Table,h=a.data.themeBrowse;g.addColumn(new PxFacetSearch.Column("themeid",h.ids)),g.addColumn(new PxFacetSearch.Column("themename",h.names)),g.addColumn(new PxFacetSearch.Column("themeprettyname",h.prettynames)),a.view=new a.controls.ThemeBrowseView(g),b=$(".tile").outerWidth(!0),c=$(".tile").first().offset().left,$(".themeProjects").each(function(){var a=$(this),c=a.find(".themeProject"),d=c.length;d>0?a.css({width:Math.ceil(d/2)*b+"px"}):(c.hide(),a.find(".themePrevPageButton").hide(),a.find(".themeNextPageButton").hide())}),$(".themeNextPageButton").click(function(){var a=$(this).parent().find(".themeContentInner");a&&d(a)}),$(".themePrevPageButton").click(function(){var a=$(this).parent().find(".themeContentInner");a&&e(a)}),$(".themeContentInner").scroll(function(){f($(this))}),$(".themeContentInner").each(function(){f($(this))});var i="search",j=$("#themeSearch"),k=new a.controls.ThemeSearchBox(j,i),l=new a.controls.ThemeSearchFilter(i,k.searchResults);$("#filtersReset").on("click",function(){j.val("").trigger("change")}),a.view.query.addFilter(l)};var d=function(a){a.animate({scrollLeft:i(a)},700,"easeInOutQuart")},e=function(a){a.animate({scrollLeft:h(a)-a.width()},700,"easeInOutQuart")},f=function(a){var b=a[0].scrollWidth-(a.scrollLeft()+a.width());a.parent().toggleClass("showNext",b>20),a.parent().toggleClass("showPrev",a.scrollLeft()>0)},g=function(a){var b=a.find(".tile").first().offset().left;return b},h=function(a){for(var c=a.scrollLeft(),d=g(a);0>d;)d+=b;return d+=c},i=function(a){for(var c=a.scrollLeft(),d=g(a),e=a.width();e-b>d;)d+=b-.5;return d+=c}}(),function(){function b(a){var b,c,d,e=[];for(b=0,c=a.length;c>b;b++)d=a[b],"string"===jQuery.type(d)&&(d=jQuery.trim(d)),(d||0===d||d===!1)&&e.push(d);return 0===e.length?null:1===e.length?e[0]:e}function c(a){var c,d,e,f=[];for(c=0,d=a.length;d>c;c++)e=a[c],e&&e.indexOf(",")>=0&&(e=b(e.split(","))),f.push(e);return f}function d(){$(".nano").nanoScroller()}function e(){var a=$(".clampText");a.each(function(a,b){var c="  [ ... ]",d=$(b),e=d.clone().addClass("clampTextExpand"),f=$clamp(b,{clamp:$(b).data("linecount")||5,useNativeClamp:!1,truncationChar:c}),g="undefined"!=typeof f.clamped;g&&$(b).html($(b).html().replace(c,' <span class="clampTextMore">...</span>')).after(e),setTimeout(function(){d.delay(500).css("opacity",1)},100)}),$(".clampTextMore").click(function(){$(this).parent().siblings(".clampTextExpand").show(),$(this).parent().siblings("#clampText").show(),$(this).parent().hide(),d()}),d()}CyArk.pages.viewTheme=function(b){var c=new a.controls.SatelliteMap(b.latitude,b.longitude,b.zoomLevel);_.each(b.mapPoints,function(a){c.addMarker(a.latitude,a.longitude,a.url,a.project_id,a.country,a.name)}),$(".nano").nanoScroller({flashDelay:1e3,preventPageScrolling:!0}),$("#projectInfoButton").click(f),$(".navInfo").click(f),$(".infoBoxClose").click(function(){f(!1)})},CyArk.pages.viewTheme2=function(b){function d(){var a=[];return _.each(b.mapDataPins,function(b){a[b.classification]?a[b.classification].push(b):a[b.classification]=[b]}),a}function h(){var a=[];return _.each(b.mapClasses,function(b){a[b.id]?a[b.id].push(b):a[b.id]=[b]}),a}var i=new a.controls.SatelliteMap(b.latitude,b.longitude,b.zoomLevel),j='<div class="factSection"><div class="factHeader">CyArk Projects in Theme:</div>';_.each(b.mapPoints,function(a){i.addInfoMarker(a.latitude,a.longitude,a.url,a.project_id,a.country,a.name,a.timeRange),j+='<div class="factText"><a href="'+a.url+'">'+a.name+"</a></div>"}),j+="</div>",_.each(b.mapLayers,function(a){i.addLayer(a.path,a.name,a.layer_id,a.time_range_start,a.time_range_end)}),_.each(b.mapGeoLines,function(a){i.addGeoLines(a.id,a.theme,a.points,a.title,a.description,a.file,a.file_type,a.time_range_start,a.time_range_end,a.style,a.color,a.classification,a.media)});var k=d(),l=h();for(var m in k)i.addDataPins(k[m],l[m][0]);_.each(b.mapNonProjectPins,function(a){i.addNonProjectPins(a.id,a.theme_id,a.latitude,a.longitude,a.title,a.description,a.file,a.file_type,a.classification,a.time_range_start,a.time_range_end,a.media,b.mapClasses)});var n=a.table=new PxFacetSearch.Table,o=a.data.projectBrowse;n.addColumn(new PxFacetSearch.Column("id",o.ids)),n.addColumn(new PxFacetSearch.Column("prettyId",o.prettyIds)),n.addColumn(new PxFacetSearch.Column("projectName",o.projectNames)),n.addColumn(new PxFacetSearch.Column("latitude",o.latitudes)),n.addColumn(new PxFacetSearch.Column("longitude",o.longitudes)),n.addColumn(new PxFacetSearch.Column("shortDescription",o.shortDescriptions)),n.addColumn(new PxFacetSearch.Column("image",o.images)),n.addColumn(new PxFacetSearch.CategoryColumn("country",o.countries)),n.addColumn(new PxFacetSearch.CategoryColumn("culture",c(o.cultures))),n.addColumn(new PxFacetSearch.CategoryColumn("cyark500",o.cyark500)),n.addColumn(new PxFacetSearch.CategoryColumn("theme",o.themes)),n.addColumn(new PxFacetSearch.RangeColumn("timeRange",o.timeRanges)),a.view=new a.controls.ThemeBrowseView(n,i),1===b.theme_timeline&&$("#infoBoxContainer").css("top","62px"),1===b.theme_timeline&&(a.timeline=new a.controls.Timeline,$(window).resize(a.utils.debounce(function(){a.view.resize(),a.timeline.resize()},200))),$(".nano").nanoScroller({flashDelay:1e3,preventPageScrolling:!0}),$("#projectInfoButton").click(f),$(".navInfo").click(f),$(".mapKeyInfo").click(g),$(".infoBoxClose").click(function(){f(!1)}),$(".mapBoxClose").click(function(){g(!1)}),setTimeout(function(){e(),f(!0),g(!1)},50),$("#clampText").hide(),$("#clampText").click(function(){$(".clampText").css("display","block"),$(".clampTextExpand").css("display","none")}),$("#projectsInTheme").html(j),_.each(b.filterScripts,function(a){$("#onoffswitchNP"+a).click(function(){$("#onoffswitchNP"+a).is(":checked")?$(".mapHotSpotNP"+a).show():$(".mapHotSpotNP"+a).hide()})})};var f=function(a,b){var c=$(".infoBoxContainer").hasClass("show");b&&($(".infoBoxContainer").addClass("noanimation"),setTimeout(function(){$(".infoBoxContainer").removeClass("noanimation")},1e3)),"undefined"==typeof a&&(a=!c),$(".infoBoxContainer").toggleClass("show",a),a===!1&&($(".navInfo").addClass("highlight"),setTimeout(function(){$(".navInfo").removeClass("highlight")},400)),$(".nano").nanoScroller(),$("#projectBody").toggleClass("infoOpen",a),$("#projectBody").toggleClass("infoClosed",!a)},g=function(a,b){var c=$(".mapKeyDetails").hasClass("show");b&&($(".mapKeyDetails").addClass("noanimation"),setTimeout(function(){$(".mapKeyDetails").removeClass("noanimation")},1e3)),"undefined"==typeof a&&(a=!c),$(".mapKeyDetails").toggleClass("show",a),a===!1&&($(".mapKeyInfo").addClass("highlight"),setTimeout(function(){$(".mapKeyInfo").removeClass("highlight")},400))}}(),CyArk.pages.initViewer=function(b,c){function d(a,b,d){c.suppressLoadingMessage||g.show(),c.loadingProgress&&c.loadingProgress(b),h.html(d>0?b===d?"Rendering":a+" "+(b+1)+" of "+d:a)}function e(){if(!c.suppressLoadingMessage){var a=Date.now()-i;CyArk.Viewer3D.postMessage("cyark.modelLoadTime",a),g.delay(400).fadeOut(400)}c.loadingComplete&&c.loadingComplete()}function f(){var a=$("#popup-iframe");a.attr("src","about:blank"),$("#popup-host").fadeOut({duration:250,complete:$.proxy(function(){var a=$("#popup-iframe");a.attr("src","about:blank")})})}var g,h,i;c=c||{},$(document).ready(function(){i=Date.now(),$("#exit-source").click(f),g=$("#viewerLoading"),h=$("#viewerLoadingMessage");var j=new CyArk.Viewer;j.init({container:document.getElementById(c.containerId||"container3d")}),c.hotspotSelected&&j.addEventListener("hotspotSelected",c.hotspotSelected),c.horizonChanged&&j.addEventListener("horizonChanged",c.horizonChanged),j.showSite(b,d,e),j.render();var k=a.utils.getQueryStringParameterByName("editmode");k&&new CyArk.DataCapturer(j)})}}();
